apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: chronosops-ingress
  namespace: chronosops
  labels:
    app.kubernetes.io/name: chronosops
  annotations:
    # For GKE Ingress Controller
    kubernetes.io/ingress.class: "gce"
    # Static IP
    kubernetes.io/ingress.global-static-ip-name: "chronosops-ip"
    # Google Managed Certificate for TLS
    networking.gke.io/managed-certificates: "chronosops-cert"
    # Redirect HTTP to HTTPS
    networking.gke.io/v1beta1.FrontendConfig: "chronosops-frontend-config"
spec:
  rules:
    - host: chronosops.boilerplate.online
      http:
        paths:
          # API routes
          - path: /api/*
            pathType: ImplementationSpecific
            backend:
              service:
                name: chronosops-api
                port:
                  number: 80
          # WebSocket
          - path: /ws
            pathType: Exact
            backend:
              service:
                name: chronosops-api
                port:
                  number: 80
          # Health check
          - path: /health
            pathType: Exact
            backend:
              service:
                name: chronosops-api
                port:
                  number: 80
          # Services status
          - path: /services/*
            pathType: ImplementationSpecific
            backend:
              service:
                name: chronosops-api
                port:
                  number: 80
          # Proxy to generated apps in development namespace
          - path: /apps/*
            pathType: ImplementationSpecific
            backend:
              service:
                name: chronosops-api
                port:
                  number: 80
          # Static frontend (catch-all, must be last)
          - path: /*
            pathType: ImplementationSpecific
            backend:
              service:
                name: chronosops-api
                port:
                  number: 80
    # Also serve on bare IP (no host) so it still works during cert provisioning
    - http:
        paths:
          - path: /*
            pathType: ImplementationSpecific
            backend:
              service:
                name: chronosops-api
                port:
                  number: 80
